<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>CityChainNFT</title>
  <link rel="stylesheet" href="styles.css?v=20251031222116">
<style id="ccnft-onlybg-style">
/* FORCE ONLY-BG (inline) */
:root{ --tabbar-h:56px; --header-h:44px; }
#region-overlay{ position:fixed; left:0; right:0; top:var(--header-h); bottom:var(--tabbar-h); display:none; overflow:auto; background:transparent !important; z-index:6000; }
#region-overlay.active{ display:block; }
#region-overlay .bg{ position:absolute; inset:0; background-position:center; background-size:cover; background-repeat:no-repeat; }
#region-overlay .bg::after{ content:""; position:absolute; inset:0; background:rgba(0,0,0,.35); }
/* hide EVERYTHING when only-bg mode is on */
#region-overlay[data-only-bg="1"] .panel,
#region-overlay[data-only-bg="1"] .content,
#region-overlay[data-only-bg="1"] .header,
#region-overlay[data-only-bg="1"] .controls,
#region-overlay[data-only-bg="1"] .list,
#region-overlay[data-only-bg="1"] .card{ display:none !important; }
.bottombar,.tabbar{ position:fixed; left:0; right:0; bottom:0; z-index:7000; }
</style>
</head>
<body>
  <div id="app">
    <header class="topbar"><div class="title">Metropolis</div></header>

    <main class="content">
      <section id="tab-shop" class="tab" data-tab-pane="shop">
  <img id="store-map-test" src="https://kiril1l1l1l1l.github.io/citychain-nft/static/newmap.png?v=20251031211158" alt="Map preview" style="width:100%;max-width:720px;display:block;margin:16px auto;border-radius:12px;opacity:.95;">
        <div class="stub">Здесь будет магазин.</div>
      </section>

      <!-- КАРТА → МЕНЮ РЕГИОНОВ -->
      <section id="tab-map" class="menu-regions menu-regions menu-regions tab active data-tab-pane=map">
        <div class="menu-wrap">
          <h2 class="menu-title">Регионы</h2>
          <div class="regions-grid" id="regions-grid"></div>
        </div>
      </section>

      <section id="tab-profile" class="tab" data-tab-pane="profile">
        <div class="stub">Профиль пользователя.</div>
      </section>
    </main>

    <!-- Нижний таббар -->
    <nav class="bottombar">
      <button id="tab-btn-shop" class="tabbtn" data-tab="shop" onclick="switchTabInline('shop')">Магазин</button>
      <button id="tab-btn-map" class="tabbtn" data-tab="map" onclick="switchTabInline('map')">Карта</button>
      <button id="tab-btn-profile" class="tabbtn" data-tab="profile" onclick="switchTabInline('profile')">Профиль</button>
    </nav>
  </div>

  <!-- Оверлей региона -->
  <div id="region-overlay" class="region-overlay" aria-hidden="true">
    <div class="bg"></div>
    <div class="panel">
      <div class="header">
        <div class="title" id="region-title"></div>
        <div class="controls">
          <!-- скелет фильтров/сортировки -->
          <button class="btn ghost" id="btn-filters" disabled>Фильтры (скоро)</button>
          <select class="select" id="sort-select" disabled>
            <option value="price-asc">Цена ↑</option>
            <option value="price-desc">Цена ↓</option>
            <option value="class">Класс</option>
            <option value="type">Тип</option>
          </select>
          <button class="btn" id="btn-back" onclick="closeRegionInline()">Назад</button>
        </div>
      </div>
      <div class="list" id="region-list"></div>
    </div>
  </div>

  <script src="app.js?v=20251031222116"></script>></script>></script>
  <script>
  // INLINE_FALLBACK_REGIONS: если сетка пустая через 300мс — рисуем меню инлайном
  (function(){
    var r = [
      {id:'kiranomiya',name:'Kiranomiya',bg:'kiranomiya.png'},
      {id:'noroburg',name:'Noroburg',bg:'noroburg.png'},
      {id:'russet-skyline',name:'Russet Skyline',bg:'russet-skyline.png'},
      {id:'san-maris',name:'San Maris',bg:'san-maris.png'},
      {id:'solmara',name:'Solmara',bg:'solmara.png'},
      {id:'valparyn',name:'Valparyn',bg:'valparyn.png'},
      {id:'nordhaven',name:'Nordhaven',bg:'nordhaven.png'},
      {id:'nihon',name:'Nihon',bg:'nihon.png'}
    ];
    setTimeout(function(){
      var grid = document.getElementById('regions-grid');
      if(!grid) return;
      if(grid.children.length > 0) return;
      r.forEach(function(x){
        var b = document.createElement('button');
        b.className = 'region-btn';
        b.innerHTML = '<div class="name">'+x.name+'</div><small>Открыть</small>';
        b.onclick = function(){
          document.getElementById('region-title').textContent = x.name;
          document.querySelector('#region-overlay .bg').style.backgroundImage = 'url("static/regions/'+x.bg+'?v='+Date.now()+'")';
          document.getElementById('region-overlay').classList.add('active');
          document.getElementById('region-overlay').setAttribute('aria-hidden','false');
          // три одинаковых карточки (инлайн)
          var list = document.getElementById('region-list'); list.innerHTML='';
          for(var i=0;i<3;i++){
            var c = document.createElement('div'); c.className='card';
            c.innerHTML='<div><div class="title">House</div><div class="meta"><span>Класс: A</span><span>Площадь: 120 m²</span></div></div><div class="actions"><div class="price">$ 100,000</div><div class="status">Available</div><button class="btn" disabled>Buy (скоро)</button></div>';
            list.appendChild(c);
          }
        };
        grid.appendChild(b);
      });
    }, 300);
  })();
  </script>
  <script>
    // inline fallback на случай если внешние обработчики не подцепились
    function switchTabInline(name){
      try{
        document.querySelectorAll('.tab').forEach(function(t){ t.classList.remove('active'); });
        var pane = document.getElementById('tab-' + name) || document.querySelector('[data-tab-pane="'+name+'"]');
        if(pane) pane.classList.add('active');
        closeRegionInline();
      }catch(e){}
    }
    function closeRegionInline(){
      var ov = document.getElementById('region-overlay');
      if(!ov) return;
      ov.classList.remove('active');
      ov.setAttribute('aria-hidden','true');
      var bg = ov.querySelector('.bg');
      if(bg) bg.style.backgroundImage = '';
    }
  </script>
<script id="ccnft-onlybg-script">
(function(){
  console.log("[CityChainNFT] ONLYBG inline patch ACTIVE");
  const BASE = "https://kiril1l1l1l1l.github.io/citychain-nft/static/regions/";
  const FILES = {
    kiranomiya:"FonKiranomiya.png",
    noroburg:"FonNorroburg.png",
    "russet-skyline":"FonRussetSkyline.png",
    "san-maris":"FonSanMaris.png",
    solmara:"FonSolmara.png",
    valparyn:"FonValparin.png",
    nordhaven:"FonNordhavean.png",
    nihon:"FonNihon.png"
  };

  // ensure bg helper
  function ensureBg(overlay){
    let bg = overlay.querySelector(".bg");
    if(!bg){
      bg = document.createElement("div");
      bg.className = "bg";
      overlay.prepend(bg);
    }
    return bg;
  }

  // hard override openRegion
  window.openRegion = function(r){
    const overlay = document.getElementById("region-overlay");
    if(!overlay) return;
    const bg = ensureBg(overlay);
    const file = FILES[r && r.id] || "FonValparin.png";
    const url  = BASE + file + "?v=" + Date.now();
    console.log("[CityChainNFT] ONLY-BG ->", r && r.id, url);
    bg.style.backgroundImage = "url('" + url + "')";
    overlay.setAttribute("data-only-bg","1");
    overlay.classList.add("active");
    overlay.setAttribute("aria-hidden","false");
    document.documentElement.classList.add("no-scroll");
    document.body.classList.add("no-scroll");
  };

  // make sure closeRegion disables only-bg too
  window.closeRegion = function(){
    const overlay = document.getElementById("region-overlay");
    if(!overlay) return;
    overlay.classList.remove("active");
    overlay.removeAttribute("data-only-bg");
    overlay.setAttribute("aria-hidden","true");
    document.documentElement.classList.remove("no-scroll");
    document.body.classList.remove("no-scroll");
  };

  // Safety: watch for overlay re-renders and keep .bg present
  const ov = document.getElementById("region-overlay");
  if (ov){
    const mo = new MutationObserver(()=> ensureBg(ov));
    mo.observe(ov, {childList:true, subtree:true});
  }
})();
</script>



<script id="ccnft-force-onlybg-final">
(function(){
  const BASE = "https://kiril1l1l1l1l.github.io/citychain-nft/static/regions/";
  const FILES = {
    kiranomiya:"FonKiranomiya.png",
    noroburg:"FonNorroburg.png",
    "russet-skyline":"FonRussetSkyline.png",
    "san-maris":"FonSanMaris.png",
    solmara:"FonSolmara.png",
    valparyn:"FonValparin.png",
    nordhaven:"FonNordhavean.png",
    nihon:"FonNihon.png"
  };

  // бейдж — легко понять, что override подхватился
  (function(){
    var b=document.getElementById("ccnft-js-badge");
    if(!b){
      b=document.createElement("div");
      b.id="ccnft-js-badge";
      b.textContent="CCNFT JS override active";
      b.style.cssText="position:fixed;right:8px;top:8px;z-index:99999;background:#22a;color:#fff;padding:4px 8px;border-radius:8px;font:12px system-ui";
      document.body.appendChild(b);
    }
  })();

  function ensureBg(ov){
    var bg=ov.querySelector(".bg");
    if(!bg){ bg=document.createElement("div"); bg.className="bg"; ov.prepend(bg); }
    return bg;
  }

  function install(){
    window.openRegion = function ONLY_BG_FORCED(r){
      var ov=document.getElementById("region-overlay"); if(!ov) return;
      var bg=ensureBg(ov);
      var id=r && r.id; var file=FILES[id] || "FonValparin.png";
      var url=BASE + file + "?v=" + Date.now();
      console.warn("[CCNFT] ONLY-BG ->", id, url);

      bg.style.backgroundImage  = "url('"+url+"')";
      bg.style.backgroundSize   = "cover";
      bg.style.backgroundPosition = "center";
      bg.style.backgroundRepeat = "no-repeat";

      ov.setAttribute("data-only-bg","1");
      ov.classList.add("active");
      ov.setAttribute("aria-hidden","false");
      document.documentElement.classList.add("no-scroll");
      document.body.classList.add("no-scroll");
    };
  }

  install();
  // если кто-то перезапишет openRegion — вернём нашу версию
  setInterval(function(){
    if(!window.openRegion || String(window.openRegion).indexOf("ONLY_BG_FORCED")===-1){
      install();
    }
  },1200);

  window.closeRegion = function(){
    var ov=document.getElementById("region-overlay"); if(!ov) return;
    ov.classList.remove("active");
    ov.removeAttribute("data-only-bg");
    ov.setAttribute("aria-hidden","true");
    document.documentElement.classList.remove("no-scroll");
    document.body.classList.remove("no-scroll");
  };
})();
</script>
</body>
</html>













































